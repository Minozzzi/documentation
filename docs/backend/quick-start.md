# Quick start
This guide describes the strucutre, modules & workflow of the backend which allow you write plugins or access the HTTP API.<br />
The source code itself is as very well documented. Simple browse through the files and read the provided comments in jsdoc flavor.

On every (backend) page, you can find at the top a litle link to the source code of the file, which autogenerated documentation you are currently reading.

![link to source code](../../img/link-to-source-code.png)

<hr />

## Intoduction

##### HTTP API
The backend itself is bascily a HTTP Server which supports REST like requests.<br />
On top of that, some resources and WebSocket endpoints which can be used to send&receive events.

For better understing about the HTTP API, we provide a [postman collection](https://github.com/OpenHausIO/backend/blob/dev/postman.json).<br />
All http related stuff is done in the [routes](https://github.com/OpenHausIO/backend/tree/dev/routes) folder.<br />

There is a generic rest operations handler (`rest-handler.js`), any other "special" case is seperated in its own file. (E.g: `router.api.devices.js`, `router.api.events.js `)

This documentation does not provide any more information about the HTTP API.


##### Dataflow
The basis of the dataflow is a bridge into the local network over a WebSocket connection.<br />
All further communication relies on this topology.

![ws-client-connection](../../img/ws-client-connection.png)

In the backend is it then possible to "pre/post" modifie the incoming/outgoing data.<br />
This is done through [adapter](https://github.com/OpenHausIO/backend/tree/dev/adapter). Adapter are [Transform streams](https://nodejs.org/dist/latest-v16.x/docs/api/stream.html#class-streamtransform) under the hood.

<object data="../../img/adapter-data-flow.svg" type="image/svg+xml"></object>

The cloud on the left side represents the connection to the client/device over a WebSocket.<br />
The right cloud is something that "runs" inside the backend, e.g. Command handler that sends data to the device or custom plugin that handles protocol specific implementation that is not provided by adapter. 

![flow chain](../../img/data-chain.png)

Read more about streams:
- https://nodejs.org/dist/latest-v16.x/docs/api/stream.html#class-streamduplex
- https://nodejs.org/dist/latest-v16.x/docs/api/stream.html#class-streamtransform
- https://github.com/websockets/ws/blob/HEAD/doc/ws.md#createwebsocketstreamwebsocket-options


##### Components
Components are abstractions layer for handling "items".<br />
A item can be (for example) a [room instance](backend/components/rooms/class.room.js), [device instance](backend/components/devices/class.device.js) or [endpoint object](backend/components/endpoints/class.endpoint.js).

Take a look on the overview/summary page for [components](backend/components/).


##### Helper
Helper functions are by use provided functions that makes coding hopfully easier.<br />
Many people include in their packages "large" libraries like lodash, async, request, and many more.<br />
To avoid this, we provide a litle toolset of functions that you can use instead of external libraries.

Something missing? Open a issue and ask for it: https://github.com/OpenHausIO/backend/issues/new

## Synopsis
This is a short, overall overview, which gives you a first impression how things work.<br />
The source code itself is keept simple and split into small files, which makes it easier to read and understand.<br />
If something in the documentation is not so clear, may a look at the source code help.

Is something unclear, need to be explaind, want to chat or something else, just contact us.<br />
Via E-Mail: hello@open-haus.io or [GitHub](https://github.com/OpenHausIO): its allways a good contact point.